doctype html
html(lang="de")
  head
    title Kochbuch - Einstellungen
    include includes/meta.pug
    link(rel="stylesheet", href="/css/settings.css")
    script(type="module" src="/scripts/src/modules/recipes-db.mjs")
  body
    - var page = 'settings'
    include includes/nav.pug
    #settings
      h2 Einstellungen
      div
        label(for="diet") ErnÃ¤hrung
        select#diet(name="diet")
          option(value="alles") Alles
          option(value="vegetarisch") Vegetarisch
          option(value="vegan") Vegan
      form(action="/settings", method="get")
        label(for="listCode") Einkaufslisten Code
        input(type="text", name="listCode", value=session.listCode || '', placeholder="Einkaufslisten Code")
        label(for="planCode") Wochenplan Code
        input(type="text", name="planCode", value=session.planCode || '', placeholder="Wochenplan Code")
        button(type="submit") Speichern
      #advanced
        label Erweiterte Einstellungen
        button.inverted#manual-sync Rezepte manuell synchronisieren
    script(type="module").
      import { refreshDatabase } from '/scripts/src/modules/recipes-db.mjs';
      const dietSelect = document.getElementById('diet');
      const currentDiet = window.localStorage.getItem('diet');
      if (currentDiet) {
        dietSelect.value = currentDiet;
      }
      dietSelect.addEventListener('change', (event) => {
        const { value } = event.target;
        window.sessionStorage.removeItem('recipes');
        window.sessionStorage.removeItem('state');
        if (value === 'alles') {
          window.localStorage.removeItem('diet');
        } else {
          window.localStorage.setItem('diet', value);
        }
      });

      document.getElementById('manual-sync').addEventListener('click', refreshDatabase);
